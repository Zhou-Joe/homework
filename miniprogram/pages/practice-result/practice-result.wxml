<!--pages/practice-result/practice-result.wxml-->
<view class="container">
  <!-- AIåˆ†æçŠ¶æ€æç¤º -->
  <view class="analysis-status" wx:if="{{analysisStatus.isAnalyzing}}">
    <view class="status-content">
      <view class="loading-icon">
        <view class="spinner"></view>
      </view>
      <view class="status-text">
        <text class="status-title">AIåˆ†æè¿›è¡Œä¸­</text>
        <text class="status-desc">è€å¸ˆæ­£åœ¨è®¤çœŸåˆ†ææ‚¨çš„ç­”æ¡ˆï¼Œè¯·ç¨å€™...</text>
      </view>
      <view class="status-count">
        <text class="count-number">{{analysisStatus.pendingCount}}</text>
        <text class="count-label">å¾…åˆ†æ</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ç»ƒä¹ ç»“æœä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="content" wx:else>
    <!-- æ€»ä½“æˆç»©å¡ç‰‡ -->
    <view class="score-card">
      <view class="score-header">
        <text class="score-title">æ€»ä½“æˆç»©</text>
        <view class="score-icon">ğŸ†</view>
      </view>
      <view class="score-content">
        <view class="total-score">
          <text class="score-number">{{totalScore}}</text>
          <text class="score-unit">åˆ†</text>
        </view>
        <view class="score-stats">
          <view class="stat-item">
            <text class="stat-value correct">{{correctCount}}</text>
            <text class="stat-label">ç­”å¯¹</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value total">{{totalCount}}</text>
            <text class="stat-label">æ€»é¢˜æ•°</text>
          </view>
        </view>
        <view class="progress-container">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{accuracyRate}}%"></view>
          </view>
          <text class="progress-text">æ­£ç¡®ç‡ {{accuracyRate}}%</text>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section">
      <view class="stats-title">
        <text>ğŸ“Š ç»ƒä¹ ç»Ÿè®¡</text>
      </view>
      <view class="stats-grid">
        <view class="stat-card">
          <view class="stat-icon">â±ï¸</view>
          <view class="stat-info">
            <text class="stat-number">{{totalTime}}</text>
            <text class="stat-desc">åˆ†é’Ÿ</text>
          </view>
          <text class="stat-label">æ€»ç”¨æ—¶</text>
        </view>
        <view class="stat-card">
          <view class="stat-icon">ğŸ”¥</view>
          <view class="stat-info">
            <text class="stat-number">{{maxStreak}}</text>
            <text class="stat-desc">é¢˜</text>
          </view>
          <text class="stat-label">è¿ç»­æ­£ç¡®</text>
        </view>
        <view class="stat-card">
          <view class="stat-icon">ğŸ¯</view>
          <view class="stat-info">
            <text class="stat-number">{{knowledgeCount}}</text>
            <text class="stat-desc">ä¸ª</text>
          </view>
          <text class="stat-label">çŸ¥è¯†ç‚¹è¦†ç›–</text>
        </view>
        <view class="stat-card">
          <view class="stat-icon">ğŸ“ˆ</view>
          <view class="stat-info">
            <text class="stat-number">{{avgDifficulty}}</text>
            <text class="stat-desc"></text>
          </view>
          <text class="stat-label">å¹³å‡éš¾åº¦</text>
        </view>
      </view>
    </view>

    <!-- ç­”é¢˜è¯¦æƒ… -->
    <view class="questions-section">
      <view class="section-header">
        <text class="section-title">ğŸ“ ç­”é¢˜è¯¦æƒ…</text>
        <view class="section-subtitle">
          <text class="completed-count">{{analysisStatus.completedCount}}</text>
          <text class="separator">/</text>
          <text class="total-count">{{totalCount}}</text>
          <text class="completion-text">å·²å®Œæˆ</text>
        </view>
      </view>
      
      <view class="questions-list">
        <view class="question-item" 
              wx:for="{{practiceRecords}}" 
              wx:key="id"
              data-index="{{index}}"
              bindtap="onViewQuestionDetail">
          <view class="question-number">
            <text class="number">{{index + 1}}</text>
          </view>
          <view class="question-info">
            <text class="question-title">é¢˜ç›®{{index + 1}}</text>
            <text class="knowledge-info" wx:if="{{item.exercise && item.exercise.knowledge_points && item.exercise.knowledge_points.length > 0}}">
              {{item.exercise.knowledge_points[0].name}}
            </text>
            <text class="knowledge-info" wx:else>é€šç”¨é¢˜</text>
          </view>
          <view class="question-status">
            <view class="status-badge status-{{item.status}}">
              <text class="status-text">{{getStatusText(item.status)}}</text>
            </view>
          </view>
          <view class="question-action" wx:if="{{item.status !== 'pending'}}">
            <text class="action-icon">ğŸ‘</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions-section">
      <button class="action-btn primary" bindtap="onRepractice">
        <text class="btn-icon">ğŸ”„</text>
        <text class="btn-text">å†æ¬¡ç»ƒä¹ </text>
      </button>
      <button class="action-btn secondary" bindtap="onViewHistory">
        <text class="btn-icon">ğŸ“š</text>
        <text class="btn-text">ç»ƒä¹ å†å²</text>
      </button>
      <button class="action-btn tertiary" bindtap="onShareScore">
        <text class="btn-icon">ğŸ“¤</text>
        <text class="btn-text">åˆ†äº«æˆç»©</text>
      </button>
    </view>
  </view>
</view>
