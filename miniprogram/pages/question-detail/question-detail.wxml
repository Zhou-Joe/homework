<!--pages/question-detail/question-detail.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½é¢˜ç›®è¯¦æƒ…ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="content" wx:else>
    <!-- é¢˜ç›®å¤´éƒ¨ä¿¡æ¯ -->
    <view class="question-header">
      <view class="question-number">
        <text class="number">{{questionData.questionNumber}}</text>
      </view>
      <view class="question-meta">
        <view class="difficulty-badge" style="background-color: {{getDifficultyColor(questionData.exercise.difficulty)}}; color: white;">
          <text class="difficulty-text">{{getDifficultyText(questionData.exercise.difficulty)}}</text>
        </view>
        <text class="response-time">ç”¨æ—¶ï¼š{{formatResponseTime(questionData.responseTime)}}</text>
      </view>
    </view>

    <!-- çŸ¥è¯†ç‚¹ä¿¡æ¯ -->
    <view class="section knowledge-section" wx:if="{{questionData.knowledgePoints.length > 0}}">
      <view class="section-header">
        <text class="section-icon">ğŸ“š</text>
        <text class="section-title">çŸ¥è¯†ç‚¹</text>
      </view>
      <view class="knowledge-tags">
        <view class="knowledge-tag" wx:for="{{questionData.knowledgePoints}}" wx:key="id">
          <text class="tag-text">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- é¢˜ç›®å†…å®¹ -->
    <view class="section content-section" wx:if="{{questionData.exercise.question_text || questionData.exercise.question_image}}">
      <view class="section-header">
        <text class="section-icon">ğŸ“</text>
        <text class="section-title">é¢˜ç›®å†…å®¹</text>
        <view class="action-btn" bindtap="toggleAnalysis">
          <text class="action-icon">ğŸ¤–</text>
        </view>
      </view>
      <view class="content-body">
        <!-- æ€»æ˜¯æ˜¾ç¤ºæ–‡æœ¬å†…å®¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ -->
        <view class="text-content" wx:if="{{questionData.exercise.question_text}}">
          <latex-renderer
            content="{{questionData.exercise.question_text}}"
            font-size="16"
          ></latex-renderer>
        </view>
        
        <!-- å›¾ç‰‡æ§åˆ¶æŒ‰é’® -->
        <view class="image-control" wx:if="{{questionData.exercise.question_image}}">
          <button class="image-toggle-btn" bindtap="toggleQuestionImage">
            <text class="btn-icon">{{showQuestionImage ? 'ğŸ‘ï¸' : 'ğŸ–¼ï¸'}}</text>
            <text class="btn-text">{{showQuestionImage ? 'éšè—å›¾ç‰‡' : 'æ˜¾ç¤ºå›¾ç‰‡'}}</text>
          </button>
        </view>
        
        <!-- å›¾ç‰‡å®¹å™¨ -->
        <view class="image-container" wx:if="{{questionData.exercise.question_image && showQuestionImage}}">
          <image 
            class="question-image" 
            src="{{questionData.exercise.question_image}}" 
            mode="widthFix"
            data-url="{{questionData.exercise.question_image}}"
            bindtap="onViewImage"
          ></image>
        </view>
        
        <!-- å¦‚æœæ—¢æ²¡æœ‰æ–‡æœ¬ä¹Ÿæ²¡æœ‰å›¾ç‰‡ï¼Œæ˜¾ç¤ºæç¤º -->
        <view class="empty-content" wx:if="{{!questionData.exercise.question_text && !questionData.exercise.question_image}}">
          <text class="empty-text">é¢˜ç›®å†…å®¹åŠ è½½å¤±è´¥</text>
        </view>
      </view>
    </view>

    <!-- å­¦ç”Ÿç­”æ¡ˆ -->
    <view class="section answer-section" wx:if="{{questionData.studentAnswer}}">
      <view class="section-header">
        <text class="section-icon">âœï¸</text>
        <text class="section-title">ä½ çš„ç­”æ¡ˆ</text>
        <view class="action-btn" data-text="{{questionData.studentAnswer}}" bindtap="onCopyText">
          <text class="action-text">å¤åˆ¶</text>
        </view>
      </view>
      <view class="content-body student-answer">
        <latex-renderer
          content="{{questionData.studentAnswer}}"
          font-size="16"
        ></latex-renderer>
      </view>
    </view>

    <!-- æ­£ç¡®ç­”æ¡ˆ -->
    <view class="section correct-answer-section" wx:if="{{questionData.correctAnswer}}">
      <view class="section-header">
        <text class="section-icon">âœ…</text>
        <text class="section-title">æ ‡å‡†ç­”æ¡ˆ</text>
        <view class="action-btn" data-text="{{questionData.correctAnswer}}" bindtap="onCopyText">
          <text class="action-text">å¤åˆ¶</text>
        </view>
      </view>
      <view class="content-body correct-answer">
        <latex-renderer
          content="{{questionData.correctAnswer}}"
          font-size="16"
        ></latex-renderer>
      </view>
    </view>


  <view class="section solution-section" wx:if="{{questionData.llmAnalysis.feedback}}">
      <view class="section-header">
        <text class="section-icon">ğŸ“</text>
        <text class="section-title">AIåˆ†æ</text>
        <view class="action-btn" data-text="{{questionData.llmAnalysis.feedback}}" bindtap="onCopySolutionSteps">
          <text class="action-text">å¤åˆ¶</text>
        </view>
      </view>
      <view class="content-body solution-steps">
        <latex-renderer
          content="{{questionData.llmAnalysis.feedback}}"
          font-size="16"
        ></latex-renderer>
      </view>
    </view>


    <!-- è§£é¢˜æ­¥éª¤ï¼ˆæ›¿æ¢åŸæ¥çš„ç­”é¢˜çŠ¶æ€ï¼‰ -->
    <view class="section solution-section" wx:if="{{questionData.exercise.answer_steps}}">
      <view class="section-header">
        <text class="section-icon">ğŸ“</text>
        <text class="section-title">è§£é¢˜æ­¥éª¤</text>
        <view class="action-btn" data-text="{{questionData.exercise.answer_steps}}" bindtap="onCopySolutionSteps">
          <text class="action-text">å¤åˆ¶</text>
        </view>
      </view>
      <view class="content-body solution-steps">
        <latex-renderer
          content="{{questionData.exercise.answer_steps}}"
          font-size="16"
        ></latex-renderer>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <button class="action-btn primary" bindtap="onShareQuestion">
        <text class="btn-icon">ğŸ“¤</text>
        <text class="btn-text">åˆ†äº«é¢˜ç›®</text>
      </button>
      <button class="action-btn secondary" bindtap="onGoBack">
        <text class="btn-icon">â¬…ï¸</text>
        <text class="btn-text">è¿”å›</text>
      </button>
    </view>
  </view>
</view>
