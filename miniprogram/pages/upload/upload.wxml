<view class="container">
  <!-- 标题区域 -->
  <view class="header">
    <text class="title">📸 错题上传</text>
    <text class="subtitle">拍照或选择图片，AI智能识别分析</text>
  </view>

  <!-- 上传说明 -->
  <view class="info-card">
    <text class="info-title">💡 上传说明</text>
    <view class="info-list">
      <text class="info-item">• 支持图片格式：JPG、PNG</text>
      <text class="info-item">• 文件大小不超过10MB</text>
      <text class="info-item">• AI自动识别题目内容和知识点</text>
      <text class="info-item">• 生成详细解题步骤和标准答案</text>
    </view>
  </view>

  <!-- 上传区域 -->
  <view class="upload-area" bindtap="onChooseImage">
    <block wx:if="{{!imagePath}}">
      <text class="upload-icon">📷</text>
      <text class="upload-text">点击上传错题图片</text>
      <text class="upload-hint">支持拍照或从相册选择</text>
    </block>
    <block wx:else>
      <image class="preview-image" src="{{imagePath}}" mode="aspectFit"></image>
      <view class="image-overlay">
        <text class="reupload-text">点击重新选择</text>
      </view>
    </block>
  </view>

  <!-- 图片信息 -->
  <view class="image-info" wx:if="{{imagePath}}">
    <text class="info-label">已选择图片：</text>
    <text class="info-value">{{imageName}}</text>
    <text class="info-size">{{imageSize}}</text>
  </view>

  <!-- 上传按钮 -->
  <button 
    class="upload-btn" 
    bindtap="onUpload"
    loading="{{isUploading}}"
    disabled="{{!imagePath || isUploading}}"
  >
    {{isUploading ? 'AI分析中...' : '开始AI智能分析'}}
  </button>

  <!-- 分析结果 -->
  <view class="result-card" wx:if="{{analysisResult}}">
    <view class="result-header">
      <text class="result-title">✅ AI分析结果</text>
      <view class="result-actions">
        <button class="save-btn" bindtap="onSaveExercise">保存到错题本</button>
        <button class="reset-btn" bindtap="onReset">重新上传</button>
      </view>
    </view>

    <!-- 题目信息 -->
    <view class="info-section">
      <text class="section-label">📋 题目信息</text>
      <view class="info-grid">
        <view class="info-row">
          <text class="info-name">题目标题：</text>
          <text class="info-value">{{analysisResult.title || '未识别'}}</text>
        </view>
        <view class="info-row">
          <text class="info-name">学科：</text>
          <text class="info-value">{{analysisResult.subject || '未识别'}}</text>
        </view>
        <view class="info-row">
          <text class="info-name">年级：</text>
          <text class="info-value">{{analysisResult.grade_level || '未识别'}}</text>
        </view>
        <view class="info-row">
          <text class="info-name">难度：</text>
          <text class="badge badge-{{analysisResult.difficulty}}">{{analysisResult.difficulty_text}}</text>
        </view>
      </view>
    </view>

    <!-- 知识点 -->
    <view class="info-section" wx:if="{{analysisResult.knowledge_points && analysisResult.knowledge_points.length > 0}}">
      <text class="section-label">🏷️ 知识点</text>
      <view class="tag-list">
        <block wx:for="{{analysisResult.knowledge_points}}" wx:key="index">
          <text class="tag">{{item}}</text>
        </block>
      </view>
    </view>

    <!-- 题目内容 -->
    <view class="info-section">
      <text class="section-label">❓ 题目内容</text>
      <view class="content-box">
        <text class="content-text">{{analysisResult.question_text || '暂无题目内容'}}</text>
      </view>
    </view>

    <!-- 解题步骤 -->
    <view class="info-section">
      <text class="section-label">📝 解题步骤</text>
      <view class="content-box steps">
        <text class="content-text">{{analysisResult.answer_steps || '暂无解题步骤'}}</text>
      </view>
    </view>

    <!-- 标准答案 -->
    <view class="info-section">
      <text class="section-label">✅ 标准答案</text>
      <view class="content-box answer">
        <text class="content-text">{{analysisResult.correct_answer || '暂无标准答案'}}</text>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-modal" wx:if="{{isUploading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">AI正在智能分析题目...</text>
      <text class="loading-hint">请稍候，这可能需要几秒钟</text>
    </view>
  </view>
</view>
