<view class="container">
  <!-- æ ‡é¢˜åŒºåŸŸ -->
  <view class="header">
    <text class="title">ğŸ’ª å¼ºåŒ–è®­ç»ƒ</text>
    <text class="subtitle">åŸºäºAIåˆ†æï¼Œä¸ªæ€§åŒ–æ¨èç»ƒä¹ </text>
  </view>

  <!-- ç»ƒä¹ è®¾ç½® -->
  <view class="settings-card">
    <text class="settings-title">âš™ï¸ ç»ƒä¹ è®¾ç½®</text>
    
    <!-- ç»ƒä¹ æ¨¡å¼å’Œå­¦ç§‘é€‰æ‹© -->
    <view class="setting-row">
      <view class="setting-item half">
        <text class="setting-label">ç»ƒä¹ æ¨¡å¼</text>
        <picker 
          class="mode-picker" 
          bindchange="onModeChange" 
          value="{{modeIndex}}" 
          range="{{practiceModes}}"
          range-key="name"
        >
          <view class="picker-content">
            <text class="picker-text">{{practiceModes[modeIndex].name}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
        <text class="picker-desc">{{practiceModes[modeIndex].desc}}</text>
      </view>

      <view class="setting-item half">
        <text class="setting-label">é€‰æ‹©å­¦ç§‘</text>
        <picker 
          class="subject-picker" 
          bindchange="onSubjectChange" 
          value="{{subjectIndex}}" 
          range="{{subjects}}"
          range-key="name"
        >
          <view class="picker-content">
            <text class="picker-text">{{subjects[subjectIndex] ? subjects[subjectIndex].name : 'å…¨éƒ¨å­¦ç§‘'}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <!-- é¢˜ç›®æ•°é‡ -->
    <view class="setting-item">
      <text class="setting-label">é¢˜ç›®æ•°é‡: {{questionCount}}é¢˜</text>
      <slider 
        class="count-slider" 
        min="2" 
        max="10" 
        value="{{questionCount}}" 
        bindchange="onCountChange"
        show-value
      />
    </view>

    <!-- å¼€å§‹ç»ƒä¹ æŒ‰é’® -->
    <button class="start-btn" bindtap="onStartPractice" loading="{{isLoading}}" disabled="{{isLoading}}">
      {{isLoading ? 'åŠ è½½ä¸­...' : 'å¼€å§‹ç»ƒä¹ '}}
    </button>
  </view>

  <!-- ç»ƒä¹ ç•Œé¢ -->
  <view class="practice-interface" wx:if="{{isPracticing}}">
    <!-- é¢˜ç›®å¡ç‰‡ -->
    <view class="question-card">
      <view class="question-header">
        <view class="question-badges">
          <text class="badge badge-{{currentQuestion.difficulty}}">{{currentQuestion.difficulty_text}}</text>
          <text class="badge badge-subject">{{currentQuestion.subject_name}}</text>
        </view>
      </view>
      
      <view class="question-content">
        <!-- é¢˜ç›®æ–‡æœ¬æ˜¾ç¤º -->
        <block wx:if="{{currentQuestion.question_text && currentQuestion.question_text.length > 0}}">
          <!-- LaTeXæ¸²æŸ“å™¨æ˜¾ç¤º -->
          <view class="latex-content">
            <latex-renderer
              content="{{currentQuestion.question_text}}"
              font-size="16"
            ></latex-renderer>
          </view>
        </block>
        
        <!-- å›¾ç‰‡æ§åˆ¶æŒ‰é’®å’Œå›¾ç‰‡ -->
        <block wx:if="{{currentQuestion.question_image}}">
          <view class="image-control">
            <button class="image-toggle-btn" bindtap="toggleQuestionImage">
              <text class="btn-icon">{{showQuestionImage ? 'ğŸ‘ï¸' : 'ğŸ–¼ï¸'}}</text>
              <text class="btn-text">{{showQuestionImage ? 'éšè—å›¾ç‰‡' : 'æ˜¾ç¤ºå›¾ç‰‡'}}</text>
            </button>
          </view>
          
          <view class="image-container" wx:if="{{showQuestionImage}}">
            <image class="question-image" src="http://127.0.0.1:8000{{currentQuestion.question_image}}" mode="widthFix"></image>
          </view>
        </block>
        
        <!-- å¦‚æœæ—¢æ²¡æœ‰æ–‡æœ¬ä¹Ÿæ²¡æœ‰å›¾ç‰‡ï¼Œæ˜¾ç¤ºæç¤º -->
        <block wx:if="{{!currentQuestion.question_text && !currentQuestion.question_image}}">
          <view class="empty-question">
            <text class="empty-text">é¢˜ç›®å†…å®¹åŠ è½½å¤±è´¥</text>
            <text class="empty-hint">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ</text>
            <button class="retry-btn" bindtap="onStartPractice">é‡æ–°åŠ è½½</button>
          </view>
        </block>
      </view>
    </view>

    <!-- ç­”é¢˜åŒºåŸŸ -->
    <view class="answer-card">
      <text class="answer-title">ğŸ“ è¯·åœ¨æ­¤ä½œç­”</text>
      
      <!-- æ–‡å­—ç­”æ¡ˆè¾“å…¥ -->
      <textarea 
        class="answer-input" 
        placeholder="è¯·è¾“å…¥ä½ çš„ç­”æ¡ˆ..."
        value="{{answerText}}"
        bindinput="onAnswerInput"
        maxlength="1000"
      ></textarea>

      <!-- å›¾ç‰‡ç­”æ¡ˆä¸Šä¼  -->
      <view class="image-upload" bindtap="onChooseAnswerImage">
        <block wx:if="{{!answerImage}}">
          <text class="upload-icon">ğŸ“·</text>
          <text class="upload-text">ä¸Šä¼ ç­”é¢˜å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</text>
        </block>
        <block wx:else>
          <image class="answer-image-preview" src="{{answerImage}}" mode="aspectFit"></image>
          <text class="reupload-text">ç‚¹å‡»é‡æ–°é€‰æ‹©</text>
        </block>
      </view>

      <!-- æäº¤æŒ‰é’® -->
      <view class="answer-actions">
        <button class="skip-btn" bindtap="onSkipQuestion">è·³è¿‡</button>
        <button class="submit-btn" bindtap="onSubmitAnswer" disabled="{{!answerText && !answerImage}}">
          æäº¤ç­”æ¡ˆ
        </button>
      </view>
    </view>
  </view>

  <!-- ç­”é¢˜ç»“æœåŒºåŸŸå·²éšè— - æäº¤åç›´æ¥è·³è½¬ä¸‹ä¸€é¢˜ -->

  <!-- ç»ƒä¹ å†å² -->
  <view class="history-card" wx:if="{{!isPracticing}}">
    <view class="history-header">
      <text class="history-title">ğŸ“š ç»ƒä¹ å†å²</text>
      <text class="history-subtitle">æœ€è¿‘ç»ƒä¹ è®°å½•</text>
    </view>
    
    <scroll-view class="history-scroll" scroll-y="true" style="max-height: 400px;">
      <view class="history-list">
        <block wx:for="{{practiceHistory}}" wx:key="id">
          <view class="history-item">
            <view class="history-info">
              <text class="history-date">{{item.date}}</text>
              <text class="history-mode">{{item.mode_text}}</text>
            </view>
            <view class="history-stats">
              <text class="stat">{{item.total_questions}}é¢˜</text>
              <text class="stat">{{item.correct_answers}}å¯¹</text>
              <text class="accuracy">{{item.accuracy_rate}}%</text>
            </view>
          </view>
        </block>
      </view>
      
      <block wx:if="{{practiceHistory.length === 0}}">
        <view class="empty-state">
          <text class="empty-icon">ğŸ“š</text>
          <text class="empty-text">è¿˜æ²¡æœ‰ç»ƒä¹ è®°å½•</text>
          <text class="empty-hint">å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡ç»ƒä¹ å§ï¼</text>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-modal" wx:if="{{isLoading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">æ­£åœ¨åŠ è½½é¢˜ç›®...</text>
    </view>
  </view>
</view>