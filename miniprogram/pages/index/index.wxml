<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-info">
      <view class="avatar">{{userInfo.nickname ? userInfo.nickname.charAt(0) : 'å­¦'}}</view>
      <view class="user-details">
        <text class="username">{{userInfo.nickname || 'å­¦ç”Ÿ'}}</text>
        <text class="grade">{{userInfo.grade_level || 'æœªçŸ¥å¹´çº§'}}</text>
      </view>
    </view>
    <view class="stats-overview">
      <view class="stat-item">
        <text class="stat-number">{{stats.total_exercises || 0}}</text>
        <text class="stat-label">æ€»ä¹ é¢˜</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.mistake_count || 0}}</text>
        <text class="stat-label">å¾…æ”»å…‹</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.accuracy_rate || 0}}%</text>
        <text class="stat-label">æ­£ç¡®ç‡</text>
      </view>
    </view>
  </view>

  <!-- å­¦ç§‘æŒæ¡åº¦ -->
  <view class="section-card" wx:if="{{subjectStats && subjectStats.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ“Š å­¦ç§‘æŒæ¡åº¦åˆ†æ</text>
      <text class="section-subtitle">å„ç§‘ç›®å­¦ä¹ æƒ…å†µ</text>
    </view>
    <scroll-view class="subject-scroll" scroll-x="true" show-scrollbar="false">
      <view class="subject-list">
        <block wx:for="{{subjectStats}}" wx:key="subject">
          <view class="subject-item" wx:if="{{item.total_questions > 0}}">
            <view class="subject-info">
              <text class="subject-name">{{item.subject_name}}</text>
              <text class="subject-meta">{{item.total_questions}}é¢˜ | {{item.correct_answers}}å¯¹</text>
            </view>
            <view class="subject-progress">
              <view class="progress-bar">
                <view class="progress-fill" style="width: {{item.accuracy_rate}}%"></view>
              </view>
              <text class="progress-text">{{item.accuracy_rate}}%</text>
            </view>
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- è–„å¼±çŸ¥è¯†ç‚¹ -->
  <view class="section-card" wx:if="{{weakKnowledgePoints && weakKnowledgePoints.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ¯ ç²¾å‡†æå‡ç›®æ ‡</text>
      <text class="section-subtitle">éœ€è¦é‡ç‚¹ç»ƒä¹ çš„çŸ¥è¯†ç‚¹</text>
    </view>
    <scroll-view class="knowledge-scroll" scroll-x="true" show-scrollbar="false">
      <view class="knowledge-list">
        <block wx:for="{{weakKnowledgePoints}}" wx:key="id">
          <view class="knowledge-item">
            <text class="knowledge-name">{{item.name}}</text>
            <text class="knowledge-subject">{{item.subject_name}}</text>
            <view class="mastery-bar">
              <view class="mastery-fill" style="width: {{item.mastery_level}}%"></view>
            </view>
            <text class="mastery-text">æŒæ¡åº¦: {{item.mastery_level}}%</text>
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- æœ€è¿‘é”™é¢˜ -->
  <view class="section-card" wx:if="{{recentMistakes && recentMistakes.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ“ æœ€è¿‘é”™é¢˜å›é¡¾</text>
      <text class="more-link" bindtap="onUploadNewQuestion" hover-class="more-link-hover">ä¸Šä¼ æ–°é¢˜</text>
    </view>
    <scroll-view class="mistake-scroll" scroll-y="true" style="max-height: 300px;">
      <view class="mistake-list">
        <block wx:for="{{recentMistakes}}" wx:key="id">
          <view class="mistake-item" bindtap="onExerciseTap" data-id="{{item.id}}">
            <view class="mistake-header">
              <text class="mistake-title">{{item.title || 'é”™é¢˜'}}</text>
              <view class="mistake-badges">
                <text class="badge badge-{{item.difficulty}}">{{item.difficulty_text}}</text>
                <text class="badge badge-subject">{{item.subject_name}}</text>
              </view>
            </view>
            <text class="mistake-time">{{item.created_at}}</text>
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="action-grid">
    <navigator url="/pages/upload/upload" class="action-item" hover-class="action-hover">
      <view class="action-icon upload">ğŸ“¸</view>
      <text class="action-title">ä¸Šä¼ é”™é¢˜</text>
      <text class="action-desc">æ‹ç…§è¯†åˆ«</text>
    </navigator>
    <navigator url="/pages/practice/practice" class="action-item" hover-class="action-hover">
      <view class="action-icon practice">ğŸ’ª</view>
      <text class="action-title">æ™ºèƒ½è®­ç»ƒ</text>
      <text class="action-desc">ä¸ªæ€§åŒ–æ¨è</text>
    </navigator>
    <view class="action-item" bindtap="onViewAllMistakes" hover-class="action-hover">
      <view class="action-icon view">ğŸ“š</view>
      <text class="action-title">é”™é¢˜å®åº“</text>
      <text class="action-desc">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
  </view>
</view>
