<!--pages/practice-history/practice-history.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading && practiceHistory.length === 0}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ç»ƒä¹ å†å²ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="content" wx:else>
    <!-- é¡µé¢æ ‡é¢˜ -->
    <view class="page-header">
      <text class="page-title">ç»ƒä¹ å†å²</text>
      <text class="page-subtitle">æŸ¥çœ‹æ‚¨çš„å­¦ä¹ è½¨è¿¹</text>
    </view>

    <!-- å†å²è®°å½•åˆ—è¡¨ -->
    <view class="history-list" wx:if="{{practiceHistory.length > 0}}">
      <view class="history-item" 
            wx:for="{{practiceHistory}}" 
            wx:key="id"
            bindtap="onViewResult"
            data-id="{{item.id}}">
        
        <!-- ç»ƒä¹ åŸºæœ¬ä¿¡æ¯ -->
        <view class="item-header">
          <view class="mode-info">
            <text class="mode-badge">{{item.mode_text}}</text>
            <text class="date-text">{{item.date}}</text>
          </view>
          <view class="status-info">
            <view class="status-badge" style="background-color: {{getStatusColor(item.status)}}; color: white;">
              <text class="status-text">{{getStatusText(item.status)}}</text>
            </view>
          </view>
        </view>

        <!-- ç»ƒä¹ ç»Ÿè®¡ -->
        <view class="item-stats">
          <view class="stat-item">
            <text class="stat-value">{{item.total_questions || 0}}</text>
            <text class="stat-label">é¢˜ç›®</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value correct">{{item.correct_answers || 0}}</text>
            <text class="stat-label">æ­£ç¡®</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value accuracy">{{item.accuracy_rate}}%</text>
            <text class="stat-label">æ­£ç¡®ç‡</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value score">{{item.score || 0}}</text>
            <text class="stat-label">å¾—åˆ†</text>
          </view>
        </view>

        <!-- ç»ƒä¹ è¯¦æƒ… -->
        <view class="item-details">
          <text class="time-text">{{item.time}} å¼€å§‹</text>
          <text class="duration-text">ç”¨æ—¶ {{item.total_time || '--'}} åˆ†é’Ÿ</text>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="item-actions" catchtap="stopPropagation">
          <button class="action-btn primary" 
                  bindtap="onViewResult" 
                  data-id="{{item.id}}">
            <text class="btn-text">æŸ¥çœ‹ç»“æœ</text>
          </button>
          <button class="action-btn secondary" 
                  bindtap="onShareRecord" 
                  data-index="{{index}}"
                  open-type="share">
            <text class="btn-text">åˆ†äº«</text>
          </button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!isLoading && practiceHistory.length === 0}}">
      <view class="empty-icon">ğŸ“š</view>
      <text class="empty-title">æš‚æ— ç»ƒä¹ è®°å½•</text>
      <text class="empty-desc">å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡ç»ƒä¹ å§ï¼</text>
      <button class="start-btn" bindtap="onRepractice">
        <text class="btn-text">å¼€å§‹ç»ƒä¹ </text>
      </button>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view class="load-more" wx:if="{{practiceHistory.length > 0}}">
      <view class="loading-spinner" wx:if="{{isLoading && hasMore}}"></view>
      <text class="load-more-text" wx:if="{{isLoading && hasMore}}">åŠ è½½æ›´å¤š...</text>
      <text class="load-more-text" wx:if="{{!isLoading && hasMore}}">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      <text class="load-more-text" wx:if="{{!hasMore}}">å·²åŠ è½½å…¨éƒ¨è®°å½•</text>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="bottom-btn primary" bindtap="onRepractice">
      <text class="btn-icon">ğŸ”„</text>
      <text class="btn-text">å†æ¬¡ç»ƒä¹ </text>
    </button>
    <button class="bottom-btn secondary" bindtap="onGoHome">
      <text class="btn-icon">ğŸ </text>
      <text class="btn-text">è¿”å›é¦–é¡µ</text>
    </button>
  </view>
</view>
